<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Museum3D - Infinite Hallway</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 16px;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 5px;
            pointer-events: none;
        }
        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 14px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
        }
        #controls p {
            margin: 5px 0;
        }
        #audioButton {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 16px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1000;
        }
        /* Mobile Controls */
        .mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            z-index: 1000;
        }
        
        .mobile-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid white;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 10px;
            font-size: 24px;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        .mobile-btn:active {
            background: rgba(255, 255, 255, 0.5);
        }

        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 20px;
            }
            #controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="info">Use WASD or arrow keys to move</div>
    <div id="countdown" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); color: white; font-family: Arial, sans-serif; font-size: 72px; background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 5px; pointer-events: none;">36</div>
    <div id="controls">
        <p>Controls:</p>
        <p>WASD or Arrow Keys - Move</p>
        <p>Mouse - Look around</p>
        <p>E - Interact</p>
    </div>
    <div class="mobile-controls">
        <button class="mobile-btn" id="leftBtn">‚Üê</button>
        <button class="mobile-btn" id="forwardBtn">‚Üë</button>
        <button class="mobile-btn" id="rightBtn">‚Üí</button>
    </div>
    <button id="audioButton">Play Music</button>
    
    <!-- Add audio elements with multiple sources for compatibility -->
    <audio id="introVoice" preload="auto">
        <source src="/museum3d/audio/intro_voice.mp3" type="audio/mpeg">
        <source src="audio/intro_voice.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="backgroundMusic" loop>
        <source src="audio/song.wav" type="audio/wav">
    </audio>
    
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <script type="module" src="js/main.js"></script>
    <a target="_blank" href="https://jam.pieter.com" style="font-family: 'system-ui', sans-serif; position: fixed; bottom: -1px; right: -1px; padding: 7px; font-size: 14px; font-weight: bold; background: #fff; color: #000; text-decoration: none; z-index: 10; border-top-left-radius: 12px; z-index: 10000; border: 1px solid #fff;">üïπÔ∏è Vibe Jam 2025</a>
    <a href="https://itch.io/jam/vibe-jam-2025" id="vibeJamLink" style="position: absolute; bottom: 20px; right: 20px; color: white; text-decoration: none; font-family: Arial, sans-serif; font-size: 16px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; z-index: 1000;">Vibe Jam 2025</a>
    <script>
        // BRUTE FORCE Mobile Controls - Guaranteed to work
        if (window.innerWidth <= 768) {
            const forwardBtn = document.getElementById('forwardBtn');
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            
            // Initialize directly with global variables that are hard to break
            let playerFacingAngle = 0; // in radians
            
            // Set up a global movement function that doesn't rely on any game internals
            window.movePlayerInDirection = function(direction) {
                // Get camera
                const camera = document.querySelector('canvas')._threeCamera || window.camera;
                if (!camera) return;
                
                switch(direction) {
                    case 'forward':
                        // Move forward 1 unit in facing direction
                        camera.position.x -= Math.sin(playerFacingAngle) * 1;
                        camera.position.z -= Math.cos(playerFacingAngle) * 1;
                        // Mark as moved for main loop to sync
                        window.movePlayerMoved = true;
                        break;
                    case 'left':
                        // Rotate 90 degrees left
                        playerFacingAngle += Math.PI / 2;
                        camera.rotation.y = playerFacingAngle;
                        // Mark as moved for main loop to sync
                        window.movePlayerMoved = true;
                        break;
                    case 'right':
                        // Rotate 90 degrees right
                        playerFacingAngle -= Math.PI / 2;
                        camera.rotation.y = playerFacingAngle;
                        // Mark as moved for main loop to sync
                        window.movePlayerMoved = true;
                        break;
                }
            };
            
            // Super simple event listeners with direct action
            forwardBtn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                // Move forward when touched
                if (typeof window.movePlayerInDirection === 'function') {
                    window.movePlayerInDirection('forward');
                }
            });
            
            leftBtn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                // Turn left when touched
                if (typeof window.movePlayerInDirection === 'function') {
                    window.movePlayerInDirection('left');
                }
            });
            
            rightBtn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                // Turn right when touched
                if (typeof window.movePlayerInDirection === 'function') {
                    window.movePlayerInDirection('right');
                }
            });
            
            // Set up camera access as a fallback
            // This ensures we have access to the camera directly
            let setupInterval = setInterval(function() {
                const canvas = document.querySelector('canvas');
                if (canvas && canvas.__threeContext) {
                    window.gameCanvas = canvas;
                    
                    // Try to directly access the camera
                    try {
                        const threeRenderer = canvas.__threeContext || 
                                             canvas.__renderer || 
                                             window.renderer;
                        
                        if (threeRenderer && threeRenderer.scene && threeRenderer.scene.camera) {
                            window._camera = threeRenderer.scene.camera;
                        }
                    } catch(e) {
                        console.log("Fallback camera access failed, still trying...");
                    }
                    
                    if (window.controls || window._camera) {
                        clearInterval(setupInterval);
                    }
                }
            }, 500);
            
            // Prevent any default touch behaviors on controls
            [forwardBtn, leftBtn, rightBtn].forEach(btn => {
                btn.addEventListener('touchstart', (e) => e.preventDefault());
                btn.addEventListener('touchend', (e) => e.preventDefault());
            });
            
            // Inject direct camera control after 2 seconds as final fallback
            setTimeout(function() {
                // If game is loaded but our controls aren't working,
                // directly patch the main.js animation loop
                if (window.camera && !window._camera) {
                    window._camera = window.camera;
                    console.log("Direct camera access established");
                }
                
                // FINAL BRUTE FORCE SOLUTION:
                // Replace the entire mobile controls with direct DOM-based buttons
                // that completely bypass the Three.js controls system
                if (!window.mobileControlsWorking) {
                    console.log("Implementing final brute force mobile controls");
                    
                    // Remove existing buttons
                    const mobileControls = document.querySelector('.mobile-controls');
                    if (mobileControls) mobileControls.innerHTML = '';
                    
                    // Create new buttons with inline styles for guaranteed rendering
                    const newControlsHTML = `
                        <div style="position:fixed; bottom:20px; left:0; right:0; display:flex; justify-content:center; z-index:9999;">
                            <button id="mobileBtnLeft" style="width:80px; height:80px; background:rgba(255,255,255,0.5); border:none; border-radius:50%; margin:0 10px; font-size:24px; color:black;">‚Üê</button>
                            <button id="mobileBtnForward" style="width:80px; height:80px; background:rgba(255,255,255,0.5); border:none; border-radius:50%; margin:0 10px; font-size:24px; color:black;">‚Üë</button>
                            <button id="mobileBtnRight" style="width:80px; height:80px; background:rgba(255,255,255,0.5); border:none; border-radius:50%; margin:0 10px; font-size:24px; color:black;">‚Üí</button>
                        </div>
                    `;
                    
                    // Inject new controls directly into body
                    const controlsContainer = document.createElement('div');
                    controlsContainer.innerHTML = newControlsHTML;
                    document.body.appendChild(controlsContainer.firstElementChild);
                    
                    // Set up direct event handlers
                    document.getElementById('mobileBtnForward').addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        if (window.camera) {
                            const angleY = window.camera.rotation.y || 0;
                            window.camera.position.x -= Math.sin(angleY) * 1;
                            window.camera.position.z -= Math.cos(angleY) * 1;
                        }
                    });
                    
                    document.getElementById('mobileBtnLeft').addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        if (window.camera) {
                            const current = window.camera.rotation.y || 0;
                            window.camera.rotation.y = current + Math.PI/2;
                        }
                    });
                    
                    document.getElementById('mobileBtnRight').addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        if (window.camera) {
                            const current = window.camera.rotation.y || 0;
                            window.camera.rotation.y = current - Math.PI/2;
                        }
                    });
                    
                    window.mobileControlsWorking = true;
                }
            }, 2000);
        }
    </script>
</body>
</html> 